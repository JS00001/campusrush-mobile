name: Deploy (Production)
on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # - name: Check for PRODUCTION_EXPO_TOKEN
      #   run: |
      #     if [ -z "${{ secrets.PRODUCTION_EXPO_TOKEN }}" ]; then
      #       echo "You must provide an PRODUCTION_EXPO_TOKEN secret linked to this project's Expo account in this repo's secrets. Learn more: https://docs.expo.dev/eas-update/github-actions"
      #       exit 1
      #     fi

      # - name: Setup Node
      #   uses: actions/setup-node@v3
      #   with:
      #     node-version: 18.x

      # - name: Setup EAS
      #   uses: expo/expo-github-action@v8
      #   with:
      #     eas-version: latest
      #     token: ${{ secrets.PRODUCTION_EXPO_TOKEN }}

      # - name: Install dependencies
      #   run: yarn install

      # - name: Publish update
      #   run: eas update --auto

      # Report status to slack channel via webhook
      - name: âœ… Report Status
        if: always()
        uses: ravsamhq/notify-slack-action@v1
        with:
          icon_success: ":white_check_mark:"
          icon_failure: ":x:"
          token: ${{secrets.GITHUB_TOKEN}}
          status: ${{ job.status }}
          notification_title: ""
          message_format: "{emoji} *{workflow}* {status_message} in <{repo_url}|{repo}>\n\n*Commit URL:* <${{github.event.head_commit.url}}|${{github.event.head_commit.id}}>\n*Commit Message:* ${{github.event.head_commit.message}}\n*Commit Author:* <https://github.com/${{github.event.head_commit.author.name}}|${{github.event.head_commit.author.name}}>\n*Build URL:* <${{github.event.repository.url}}/actions/runs/${{github.run_id}}|${{github.run_id}}>"
          footer: "Linked Repo <{repo_url}|{repo}>"
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL_PROD }}
